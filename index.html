<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Salesforce Popup + Iframe POC</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    header {
      background: #1f2a44;
      color: white;
      padding: 12px;
      text-align: center;
    }
    iframe {
      width: 100%;
      height: calc(100vh - 120px);
      border: none;
    }
    .actions {
      padding: 12px;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      background: #0176d3;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 6px;
    }
  </style>
</head>
<body>

<header>
  Popup Login → iframe load test (POC)
</header>

<div class="actions">
  <button onclick="loadCommunity()">Open Community</button>
</div>

<iframe id="sfFrame"></iframe>

<script>
  let iframeLoaded = false;

  function loadCommunity() {
    iframeLoaded = false;

    const iframe = document.getElementById("sfFrame");
    iframe.src = "https://orgfarm-1da6614a1f-dev-ed.develop.my.site.com";

    // If iframe does not load within X seconds, assume not logged in
    setTimeout(() => {
      if (!iframeLoaded) {
        console.log("Iframe not loaded → opening login popup");
        openLoginPopup();
      }
    }, 3000);
  }

  document.getElementById("sfFrame").onload = function () {
    iframeLoaded = true;
    console.log("Iframe loaded (session may exist)");
  };

  function openLoginPopup() {
    const popup = window.open(
      "https://orgfarm-1da6614a1f-dev-ed.develop.my.site.com",
      "sfLogin",
      "width=1200,height=800"
    );

    if (!popup) {
      alert("Popup blocked. Please allow popups.");
    }
  }
</script>

</body>
</html>
